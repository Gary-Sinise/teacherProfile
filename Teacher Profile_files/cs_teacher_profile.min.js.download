var widget,roleDefs,formData,profileEditorData,configData,configDataPath,langTerms,defaultConfigData,widgetName="teacher_profile",widgetPath=widgethost+"/widgets/"+widgetName+"/",imgChanged=!1,useDefaultImage=!1,croppieSetupComplete=!1,editorSetupComplete=!1,uploadCrop={},supportedLangs=["en-us","fr-ca","es-mx","pt-br"];function replaceDisplayedLangTerms(){$("[data-lang-term]").each((function(){var e,t,a;e=this,t=langTerms[$(this).data("langTerm")],"button"===(a=this.nodeName.toLowerCase())||"button"===$(e).attr("role")?$(e).attr("aria-label",t).attr("title",t):"img"===a?$(e).attr("alt",t):$(e).text(t),$(this).removeAttr("data-lang-term")}))}function resizeIframe(){var e=$("div.teacher_profile").outerHeight(!0)+"px";parent.window.postMessage(JSON.stringify({subject:"frameResize",message:e}),"*")}function getLanguagePack(){var e="en-us";supportedLangs.indexOf(widget.instance.lang.toLowerCase())>-1&&(e=widget.instance.lang.toLowerCase()),$.getJSON("lang/"+e+".txt",(function(e){langTerms=e})).fail((function(){langTerms={bio:"I've been a teacher at Brightspace University for over twelve years now. I am passionate about online learning, and am looking forward to teaching the class this semester.","bio-label":"About Me","teacher-name":"Mike Instructor","role-header":"Instructor Profile",facebook:"Facebook",twitter:"Twitter","background-color":"Change background color",save:"Save","remove-image":"Remove profile image","upload-image":"Upload profile image","heading-text":"Heading Text","display-name":"Display Name",close:"Close",edit:"Edit",actions:"Actions for widget",widgetTitle:"Profile Widget"}})).always((function(){recolorInit(),parent.window.postMessage(JSON.stringify({subject:"getRoleDefinitions",message:""}),"*"),parent.window.postMessage(JSON.stringify({subject:"setFrameTitle",message:{title:langTerms.widgetTitle}}),"*")}))}function processRoleDefs(e){e.editor.indexOf(widget.role.name)>-1&&($(".nav-section").show().css("display","inline-block"),$(".edit-button").on("click",(function(){return showEditorMode(),resizeIframe(),updateFormData(),!1})),$(".save-button").on("click",(function(){showLoadingOverlay(),updateFormData(!0)})),$(".remove-image").on("click",(function(){removeProfileImage()})))}function updateFormData(e){var t={},a=defaultConfigData["background-color"];$(".form-data").each((function(){var o=$(this).val(),i=$(this).attr("data-schemaid");t[i]=o,""===o.trim()?("twitter"!==i&&"facebook"!==i||!e||($(this).closest(".form-thing").next().hide(),$("."+i).hide()),"teacher-name"===i&&$(".profile-image").addClass("reduce-top"),"bio"===i&&o.replace(" ",/&nbsp;/g).replace("&#13;&#10;",/<br.*?>/g)):("teacher-name"===i&&$(".profile-image").removeClass("reduce-top"),"twitter"!==i&&"facebook"!==i||($(this).closest(".form-thing").next().show(),$("."+i).show()),"twitter"===i&&$(".twitter-link").attr("href",o),"facebook"===i&&$(".facebook-link").attr("href",o),"background-color"===i&&(changeBackgroundColor(tinycolor(o)),a=o),"bio"===i&&(o=o.replace("\r\n","N")));let r=$('div[data-schemaid="'+i+'"]');widget.replaceBioUrls&&"bio"===i?(o=replaceUrls(o),r.html(o)):r.text(o)}));var o=$(".profile-image").css("background-image");void 0===o&&(o=$(".profile-image").attr("style").replace("background-image: ","").replace("\\",""));var i=(o=o.replace(/^url\(['"]?/,"").replace(/['"]?\)$/,"")).indexOf("?");-1!==i&&(o=o.substring(0,i));var r=o.indexOf('"');if(-1!==r&&(o=o.substring(0,r)),t.filename=o,t["background-color"]=a,e){imgChanged&&useDefaultImage?t.filename=defaultConfigData.filename:imgChanged&&(t.filename="new file");var n=t;compareJson(profileEditorData,n)?hideEditorMode():(profileEditorData=n,checkColorInputs(),checkImageInputs(),processForm())}}function showEditorMode(){editorSetupComplete||setUpEditor(),$("textarea, input").each((function(){processCharCount(this)})),$("input").removeAttr("disabled"),$("textarea").removeAttr("disabled"),$(".social-media-links").find(".primary-sm").removeClass("horizontal-flex"),$(".facebook").show().addClass("edit-mode"),$(".twitter").show().addClass("edit-mode"),$(".top-accent-bg").addClass("edit-mode"),$(".top-accent-color").addClass("edit-mode"),$(".profile-image").addClass("edit-mode"),$(".editor-only").show().attr("aria-hidden","false"),$(".static-only").hide().attr("aria-hidden","true"),$(".form-thing").show()}function hideEditorMode(){$("textarea").attr("disabled",""),$("input").attr("disabled",""),$(".social-media-links").find(".primary-sm").addClass("horizontal-flex"),$(".facebook").removeClass("edit-mode"),$(".twitter").removeClass("edit-mode"),$(".top-accent-bg").removeClass("edit-mode"),$(".top-accent-color").removeClass("edit-mode"),$(".profile-image").removeClass("edit-mode"),$(".editor-only").hide().attr("aria-hidden","true"),$(".static-only").show().attr("aria-hidden","false"),imgChanged=!1,useDefaultImage=!1,hideCroppie(),hideLoadingOverlay()}function processCourseConfig(e,t){defaultConfigData={bio:langTerms.bio,"bio-label":langTerms["bio-label"],facebook:"http://facebook.com/",filename:widgethost+"/widgets/teacher_profile/img/default.png","role-header":langTerms["role-header"],"teacher-name":langTerms["teacher-name"],twitter:"https://twitter.com/","background-color":"#275C36"},configData=e?t:defaultConfigData,buildForm(),populateDisplayedFormData(),replaceDisplayedLangTerms(),hideLoadingOverlay()}function getConfigData(){parent.window.postMessage(JSON.stringify({subject:"getConfig",message:configDataPath,noCache:!0}),"*")}function populateDisplayedFormData(){var e=configData;for(var t in e)if(e.hasOwnProperty(t)){var a=$('.form-data[data-schemaid="'+t+'"]');if(""===e[t].trim()?("twitter"!==t&&"facebook"!==t||(a.closest(".form-thing").next().hide(),$("."+t).hide()),"teacher-name"===t&&$(".profile-image").addClass("reduce-top")):("teacher-name"===t&&$(".profile-image").removeClass("reduce-top"),"twitter"===t&&$(".twitter-link").attr("href",e[t]),"facebook"===t&&$(".facebook-link").attr("href",e[t]),"background-color"===t&&changeBackgroundColor(tinycolor(e[t]))),a.val(e[t]),"bio"===t&&widget.replaceBioUrls){let a=replaceUrls(e[t]);$('div[data-schemaid="'+t+'"]').html(a)}else $('div[data-schemaid="'+t+'"]').text(e[t]);$("."+t+"-counter").find(".current").text(e[t].length)}}function hideLoadingOverlay(){$(".loader-wrapper").fadeOut((function(){$(".container-fluid.hideme").hide().removeClass("hideme").fadeIn(),resizeIframe()}))}function showLoadingOverlay(){$(".loader-wrapper").fadeIn()}function textAreaAdjust(e){e.style.height="1px",e.style.height=10+e.scrollHeight+"px",resizeIframe()}function processCharCount(e){/iPhone|iPad/i.test(navigator.userAgent)&&$(e).val($(e).val().replace(/(?:\r\n|\r|\n)/g,"\n"));var t=$(e).val().length,a=$($(e).siblings(".counter")[0]),o=a.find(".current"),i=(a.find(".maximum"),$(e).attr("maxlength"));o.text(t);var r=t/i;r<.3&&(r=.3);var n=$(e).parent().find(".counter");if(t>=i){$(n).css("background-color","#FFBA59"),$(n).css("border-radius","14px"),$(n).addClass("badge"),$(n).addClass("badge-warning");var s=tinycolor.mostReadable("#FFBA59",["#000000","#FFFFFF"],{includeFallbackColors:!0,level:"AA",size:"small"}).toHexString();$(n).css("color",s),a.css("font-weight","bold")}else{var l=$(n).parent().find("label").css("color");a.css("font-weight","normal"),$(n).css("color",l),$(n).css("background-color","unset")}}function changeBackgroundColor(e){$(".top-accent-color").css("background-color",e),$(".animate-colors").removeClass("animate-colors"),$("#background-color-input").val(e);var t=tinycolor.mostReadable(e,["#565A5C","#FFFFFF"],{includeFallbackColors:!0,level:"AA",size:"small"}).toHexString();"#006fbf"===e.toHexString()?$(".save-button").addClass("orange-border"):$(".save-button").removeClass("orange-border"),$(".top-accent-bg label").css("color",t),$(".teacher-name").css("color",t),$(".role-header").css("color",t)}function buildForm(){var e=configData;e.hasOwnProperty("filename")?setProfileImage(e.filename):e.filename="",profileEditorData=e}function compareJson(e,t){var a=!0;if(Object.keys(e).length===Object.keys(t).length){for(var o in e)if(e[o]!==t[o]){a=!1;break}}else a=!1;return a}function hideCroppie(){$(".cr-slider-wrap").attr("aria-hidden","true").hide(),$(".cr-boundary").attr("aria-hidden","true").hide()}function showCroppie(e){$(".cr-slider-wrap").attr("aria-hidden","false").show(),$(".cr-boundary").attr("aria-hidden","false").show(0,(function(){uploadCrop.croppie("bind",{url:e})}))}function setProfileImage(e){var t=(new Date).getTime();$(".profile-image").css("background-image","url('"+e+"?v="+t+"')")}function removeProfileImage(){setProfileImage(defaultConfigData.filename),$("#image-upload").val(""),hideCroppie(),imgChanged=!0,useDefaultImage=!0}function setUpEditor(){$("textarea, input").keyup((function(){processCharCount(this)})),$(document).on("change","#image-upload",(function(){readFile(this)})),editorSetupComplete=!0}function setUpCroppie(e,t){uploadCrop=e.croppie({enableExif:!0,viewport:{width:150,height:150,type:"circle"}}),e.find(".cr-boundary").css({height:"150px",width:"150px"}),e.find(".cr-viewport").css({height:"150px",width:"150px"}),e.find(".mobile-view .cr-boundary").css({height:"150px"}),e.find(".mobile-view .cr-viewport").css({height:"150px",width:"150px"}),e.find(".cr-slider").attr("step","0.01"),uploadCrop.croppie("bind",{url:t}).then((function(){croppieSetupComplete=!0}))}function readFile(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){var t=e.target.result;imgChanged=!0,useDefaultImage=!1,$(".profile-image").css("background-image","none"),croppieSetupComplete?showCroppie(t):setUpCroppie($("div.profile-image"),t)},t.readAsDataURL(e.files[0])}else console.log("Sorry, your browser doesn't support the FileReader API.")}function uploadConfigData(e){formData=profileEditorData,void 0!==e&&(formData.filename=e);var t={template:"uploadCourseContent",filedata:JSON.stringify(formData),filename:"config.txt",isImage:!1};parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"uploadFile",data:t}}),"*")}function uploadProfileImage(){var e=!1;uploadCrop.croppie("result",{type:"base64",circle:!1}).then((function(t){if(e=t){var a={template:"uploadCourseContent",filedata:e,filename:Date.now()+"_TP_IMG.png",isImage:!0};parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"uploadFile",data:a}}),"*")}}))}function processForm(){imgChanged&&!useDefaultImage?uploadProfileImage():uploadConfigData()}function checkColorInputs(){$.each($('input[type="color"]'),(function(){!1===$(this).hasClass("spectrum-color")&&($(this).addClass("spectrum-color"),$(this).spectrum({preferredFormat:"hex",showInput:!0}))}))}function checkImageInputs(){$.each($('[data-schemaid="file_upload"]'),(function(e){!1===$(this).hasClass("desc-added")&&(this.id=e,$(this).addClass("desc-added"))}))}function removeBottomBorderRadius(e){$(e).addClass("no-bottom-border-radius")}function resetBottomBorderRadius(e){$(e).removeClass("no-bottom-border-radius")}function adjustColorPickerPosition(e){$(".sp-container").css("top",parseInt($(".sp-container").css("top"))+e+"px")}function addKeyboardControlsToColorPicker(e){$(".sp-thumb-el").attr("tabindex","0"),$(".sp-thumb-el").on("focus",(function(){$(".recolor-button").spectrum("set",$(this).attr("title"))}))}function events(e){var t=JSON.parse(e.data);switch(t.subject){case"doneGetReplaceStrings":"boolean"!=typeof(widget=t.message).replaceBioUrls&&(widget.replaceBioUrls=!0),configDataPath=widget.instance.domain+widget.orgUnit.path+"custom_widgets/teacher_profile/config.txt",getLanguagePack();break;case"doneGetRoleDefinitions":processRoleDefs(roleDefs=t.message),getConfigData();break;case"doneGetConfig":processCourseConfig(t.message.success,t.message.data);break;case"doneValenceRequest":switch(t.message.route){case"uploadFile":if(t.message.dataArgument.isImage){var a=widget.instance.domain+widget.orgUnit.path+"custom_widgets/teacher_profile/img/"+t.message.data.filename;console.log(decodeString(a)),setProfileImage(decodeString(a)),uploadConfigData(decodeString(a))}else hideEditorMode()}}}function focusOnPicker(){$('a, area, button, input, object, select, textarea, [tabindex="0"]').not('.recolor-button, .sp-thumb-el, .sp-palette-toggle, .sp-choose, #image-upload, .sp-input, [aria-hidden="true"]').addClass("untabbable").attr("tabindex","-1")}function unfocusOnPicker(){$(".untabbable").attr("tabindex","0").removeClass("untabbable"),$("button.recolor-button")[0].focus()}function replaceUrls(e){return e.replace(/(https?:\/\/)([^ \n])+([^ \n\.,?!)])/gi,(function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"}))}function decodeString(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function recolorInit(){$(".recolor-button").spectrum({color:"#275C36",showButtons:!0,showPalette:!0,showInput:!0,showInitial:!0,preferredFormat:"name",togglePaletteMoreText:"More",togglePaletteLessText:"Less",togglePaletteOnly:!0,showSelectionPalette:!1,paletteTabIndex:!0,chooseText:langTerms.close,appendTo:".picker-modal",show:function(){adjustColorPickerPosition(-6),removeBottomBorderRadius(this),focusOnPicker()},hide:function(){resetBottomBorderRadius(this),unfocusOnPicker()},move:function(e){changeBackgroundColor(e)},palette:[["#BBF1FA","#E8F2F9","#E9E6FF","#F6E1FA","#FAE1ED","#FAE1E2","#FAE3CF","#FAE5C8","#FFFBB2","#CDF2B1","#A5FABD","#A1F7F4"],["#00BDDD","#29A6FF","#AFA1FF","#EA82FF","#FF389B","#FF6B70","#E87511","#FFBA59","#F5EC5A","#8CCD5A","#46A661","#00AFAA"],["#00849C","#006FBF","#7862F0","#B24AC7","#BF2A75","#CD2026","#A6540D","#A87B3B","#A69F21","#59823A","#327846","#017D79"],["#005B6B","#005694","#4C3F99","#7E358C","#96215C","#A1191D","#804008","#694B25","#635F15","#3D5926","#275C36","#005E5B"]]})}$((function(){var e;$(".loader-wrapper").append('<div class="d2l-loading-spinner"><div class="d2l-loading-spinner-wrapper"><svg viewBox="0 0 42 42" class="d2l-loading-spinner-bg-blur" focusable="false"><g fill="none" fill-rule="evenodd" transform="translate(5 5)"><circle stroke="none" fill="#000" cx="16" cy="16" r="14"></circle></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-bg" focusable="false"><g fill="none" fill-rule="evenodd" transform="translate(5 5)"><circle stroke-width="0.5" cx="16" cy="16" r="16" class="d2l-loading-spinner-bg-stroke"></circle><circle stroke="none" fill="#FFF" cx="16" cy="16" r="16"></circle><circle stroke-width="2" cx="16" cy="16" r="11"></circle></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice1" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice2" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice3" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice4" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice5" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg></div></div>'),$(".editor-only").hide().attr("aria-hidden","true"),window.addEventListener("message",events,!1),parent.window.postMessage(JSON.stringify({subject:"getReplaceStrings",message:""}),"*"),$(document).on("keypress",".sp-thumb-el",(function(e){13!==e.which&&32!==e.which||(changeBackgroundColor(tinycolor($(this).attr("title"))),$(".recolor-button").spectrum("set",$(this).attr("title")),$(this).focus())})),$(document).on("keypress",".sp-input",(function(e){13===e.which&&(changeBackgroundColor(tinycolor($(this).val())),$(".recolor-button").spectrum("set",$(this).val()))})),$(document).on("keyup",".image-upload-label",(function(e){13===e.keyCode&&$(this).click()})),$(window).on("resize",(function(){clearTimeout(e),e=setTimeout(resizeIframe,500)}))}));